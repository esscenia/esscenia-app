
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gesti√≥n Escuela ESSCENIA</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div id="app">
    <div class="container mt-4">
      <h1>Gesti√≥n de Alumnos - ESSCENIA</h1>

      <button class="btn btn-primary mb-3" @click="agregarAlumno">Agregar Alumno</button>

      <ul class="list-group mb-4">
        <li class="list-group-item" v-for="a in alumnos" :key="a.ID">
          {{ a.Nombre }} - {{ a.Email }} - {{ a.Tel√©fono }} | Clases: {{ a.Clases }} | Activo: {{ a.Activo }}
        </li>
      </ul>

      <h2>Gesti√≥n de Clases</h2>
      <button class="btn btn-primary mb-3" @click="agregarClase">Agregar Clase</button>
      <ul class="list-group mb-4">
        <li class="list-group-item" v-for="c in clases" :key="c.ID">
          {{ c.Nombre }} - {{ c.Descripci√≥n }} - {{ c.Precio }}‚Ç¨
        </li>
      </ul>

      <h2>Gesti√≥n de Recibos</h2>
      <button class="btn btn-primary mb-3" @click="agregarRecibo">Generar Recibo</button>
      <ul class="list-group mb-3">
        <li class="list-group-item" v-for="r in recibos" :key="r.ID">
          AlumnoID: {{ r.AlumnoID }} | {{ r.Concepto }} - {{ r.Importe }}‚Ç¨ - {{ r.Periodo }} - Pagado: {{ r.Pagado }}
        </li>
      </ul>

      <!-- üîÑ Bot√≥n de sincronizaci√≥n -->
      <div class="text-end">
        <button class="btn btn-outline-secondary btn-sm" @click="sincronizarTodo">
          üîÑ Sincronizar con Google Sheets
        </button>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, onMounted } = Vue;
    const API_URL = "https://script.google.com/macros/s/AKfycbyf7kSO53Grb5ta-XEYQX5Ul6IOIYfuzLqrEsA-Fc9rO3FeGUxMDmBDNX8jrQCodW1y/exec";

    createApp({
      setup() {
        const alumnos = ref([]);
        const clases = ref([]);
        const recibos = ref([]);

        const fetchData = async (sheet, refVar) => {
          try {
            const res = await fetch(`${API_URL}?sheet=${sheet}`);
            const data = await res.json();
            refVar.value = data;
          } catch (error) {
            console.error("Error al cargar", sheet, error);
          }
        };

        const postData = async (sheet, dataObj, refVar) => {
          try {
            await fetch(API_URL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ sheet: sheet, data: dataObj })
            });
            fetchData(sheet, refVar);
          } catch (error) {
            console.error("Error al guardar en", sheet, error);
          }
        };

        const sincronizarTodo = () => {
          fetchData("Alumnos", alumnos);
          fetchData("Clases", clases);
          fetchData("Recibos", recibos);
        };

        onMounted(() => {
          sincronizarTodo();
        });

        return {
          alumnos,
          clases,
          recibos,
          sincronizarTodo,
          agregarAlumno: () => postData("Alumnos", {
            ID: Date.now(),
            Nombre: "Nuevo Alumno",
            Email: "nuevo@correo.com",
            Tel√©fono: "000000000",
            Clases: "",
            Activo: true
          }, alumnos),
          agregarClase: () => postData("Clases", {
            ID: Date.now(),
            Nombre: "Nueva Clase",
            Precio: 30,
            Descripci√≥n: "Descripci√≥n"
          }, clases),
          agregarRecibo: () => postData("Recibos", {
            ID: Date.now(),
            AlumnoID: "123",
            Concepto: "Cuota mensual",
            Importe: 35,
            Periodo: "2025-03",
            Pagado: false,
            FechaPago: ""
          }, recibos)
        };
      }
    }).mount("#app");
  </script>
</body>
</html>
